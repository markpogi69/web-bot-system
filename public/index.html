<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot</title>
    <style>
        :root {
            --dark-bg: #1a1a1a;
            --darker-bg: #0d0d0d;
            --message-bg: #2d2d2d;
            --user-message: #0084ff;
            --text: #ffffff;
            --text-secondary: #b0b0b0;
            --hover: #363636;
            --accent: #0084ff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--dark-bg);
            color: var(--text);
            line-height: 1.5;
            height: 100vh;
            overflow: hidden;
        }

        .chat-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
            background: var(--darker-bg);
        }

        .chat-header {
            background: var(--message-bg);
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--hover);
        }

        .chat-header h1 {
            font-size: 20px;
            font-weight: 600;
        }

        .chat-box {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            scroll-behavior: smooth;
            background: linear-gradient(to bottom, #1a1a1a, #0d0d0d);
        }

        .message {
            display: flex;
            padding: 8px 16px;
            gap: 12px;
            animation: fadeIn 0.2s ease;
            margin-bottom: 8px;
            max-width: 80%;
        }

        .message.user {
            flex-direction: row-reverse;
            margin-left: auto;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
            color: var(--text);
            font-weight: 600;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .message.bot .avatar {
            background: #404040;
            border: 2px solid #505050;
        }

        .message.user .avatar {
            background: var(--accent);
            border: 2px solid #1a95ff;
        }

        .content {
            padding: 12px 16px;
            border-radius: 18px;
            background: var(--message-bg);
            font-size: 15px;
            word-wrap: break-word;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .message.user .content {
            background: var(--accent);
        }

        .media-content {
            margin-top: 8px;
            border-radius: 12px;
            overflow: hidden;
            background: var(--message-bg);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .media-content img {
            max-width: 300px;
            width: 100%;
            height: auto;
            display: block;
            border-radius: 12px;
        }

        .media-content video {
            max-width: 300px;
            width: 100%;
            border-radius: 12px;
            background: #000;
        }

        .input-area {
            padding: 16px;
            background: var(--darker-bg);
            border-top: 2px solid var(--message-bg);
        }

        .input-wrapper {
            display: flex;
            align-items: center;
            gap: 12px;
            background: var(--message-bg);
            padding: 8px;
            border-radius: 30px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        textarea {
            flex: 1;
            padding: 12px;
            background: transparent;
            border: none;
            color: var(--text);
            font-size: 16px;
            resize: none;
            outline: none;
            max-height: 150px;
            line-height: 1.4;
        }

        textarea::placeholder {
            color: var(--text-secondary);
        }

        .send-button {
            width: 54px;
            height: 54px;
            background: var(--accent);
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .send-button:hover {
            background: #1a95ff;
            transform: scale(1.05);
        }

        .send-button svg {
            width: 28px;
            height: 28px;
            fill: white;
        }

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--message-bg);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--hover);
        }

        @media (max-width: 768px) {
            .message {
                max-width: 90%;
            }
            .input-wrapper {
                padding: 6px;
            }
            .send-button {
                width: 48px;
                height: 48px;
            }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <h1>Messenger</h1>
        </div>
        <div class="chat-box" id="chatBox"></div>
        <div class="input-area">
            <div class="input-wrapper">
                <textarea 
                    id="userInput" 
                    placeholder="Type a message or command..."
                    rows="1"
                ></textarea>
                <button class="send-button" onclick="sendMessage()">
                    <svg viewBox="0 0 24 24">
                        <path d="M16.6915026,12.4744748 L3.50612381,13.2599618 C3.19218622,13.2599618 3.03521743,13.4170592 3.03521743,13.5741566 L1.15159189,20.0151496 C0.8376543,20.8006365 0.99,21.89 1.77946707,22.52 C2.41,22.99 3.50612381,23.1 4.13399899,22.8429026 L21.714504,14.0454487 C22.6563168,13.5741566 23.1272231,12.6315722 22.9702544,11.6889879 C22.8132856,11.0605983 22.3423792,10.4322088 21.714504,10.118014 L4.13399899,1.16346272 C3.34915502,0.9 2.40734225,1.00636533 1.77946707,1.4776575 C0.994623095,2.10604706 0.8376543,3.0486314 1.15159189,3.99121575 L3.03521743,10.4322088 C3.03521743,10.5893061 3.34915502,10.7464035 3.50612381,10.7464035 L16.6915026,11.5318905 C16.6915026,11.5318905 17.1624089,11.5318905 17.1624089,12.0031827 C17.1624089,12.4744748 16.6915026,12.4744748 16.6915026,12.4744748 Z"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <script>
        const chatBox = document.getElementById('chatBox');
        const userInput = document.getElementById('userInput');

        function adjustTextareaHeight() {
            userInput.style.height = 'auto';
            userInput.style.height = Math.min(userInput.scrollHeight, 150) + 'px';
        }

        function createMessageElement(content, isBot = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isBot ? 'bot' : 'user'}`;

            const avatar = document.createElement('div');
            avatar.className = 'avatar';
            avatar.textContent = isBot ? 'AI' : 'ME';

            const contentDiv = document.createElement('div');
            contentDiv.className = 'content';

            try {
                const parsedContent = typeof content === 'string' ? JSON.parse(content) : content;
                
                if (parsedContent.type === 'video') {
                    const mediaDiv = document.createElement('div');
                    mediaDiv.className = 'media-content';
                    const video = document.createElement('video');
                    video.src = parsedContent.url;
                    video.controls = true;
                    video.preload = 'metadata';
                    mediaDiv.appendChild(video);
                    contentDiv.appendChild(mediaDiv);
                } else if (parsedContent.type === 'image') {
                    const mediaDiv = document.createElement('div');
                    mediaDiv.className = 'media-content';
                    const img = document.createElement('img');
                    img.src = parsedContent.url;
                    img.alt = parsedContent.prompt || 'Image';
                    mediaDiv.appendChild(img);
                    contentDiv.appendChild(mediaDiv);
                } else {
                    contentDiv.textContent = typeof content === 'string' ? content : JSON.stringify(content);
                }
            } catch {
                contentDiv.textContent = content;
            }

            messageDiv.appendChild(avatar);
            messageDiv.appendChild(contentDiv);
            return messageDiv;
        }

        async function sendMessage() {
            const message = userInput.value.trim();
            if (!message) return;

            const messageElement = createMessageElement(message, false);
            chatBox.appendChild(messageElement);
            chatBox.scrollTop = chatBox.scrollHeight;
            
            userInput.value = '';
            adjustTextareaHeight();

            try {
                const response = await fetch('/bot', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message })
                });

                const data = await response.json();
                const botMessage = createMessageElement(data.response, true);
                chatBox.appendChild(botMessage);
            } catch (error) {
                const errorMessage = createMessageElement('Failed to process your request', true);
                chatBox.appendChild(errorMessage);
            }
            
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        userInput.addEventListener('input', adjustTextareaHeight);

        document.addEventListener('DOMContentLoaded', () => {
            chatBox.innerHTML = '';
            const welcomeMessage = createMessageElement('Welcome! Try /eabab for random videos or /flux for image generation.', true);
            chatBox.appendChild(welcomeMessage);
        });
    </script>
</body>
</html>
